<!DOCTYPE html>
<html>
<head>
  <title>共有タイマー</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    h1 { font-size: 48px; }
    button { font-size: 20px; padding: 10px 20px; margin: 10px; }
  </style>
</head>
<body>
  <h1 id="display">60秒</h1>
  <button onclick="startTimer()">スタート</button>
  <button onclick="resetTimer()">リセット</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAfWHKmXad82HBw0zU-8k1t5OGKP5zhAdA",
      authDomain: "timer-ishikawa.firebaseapp.com",
      databaseURL: "https://timer-ishikawa-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "timer-ishikawa",
      appId: "1:367450670827:web:a721a9f1484370ca8e20ae",
      measurementId: "G-E7G8PKG9BZ",
      messagingSenderId: "367450670827"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const timerRef = ref(db, "sharedTimer");

    let countdown = 60;
    let interval = null;

    // タイマー開始
    window.startTimer = function () {
      countdown = 60;
      set(timerRef, { time: countdown, running: true });
      interval = setInterval(() => {
        countdown--;
        set(timerRef, { time: countdown, running: true });
        if (countdown <= 0) {
          clearInterval(interval);
        }
      }, 1000);
    };

    // タイマーリセット
    window.resetTimer = function () {
      clearInterval(interval);
      set(timerRef, { time: 60, running: false });
    };

    // 他の人の更新もリアルタイムで表示
    onValue(timerRef, (snapshot) => {
      const data = snapshot.val();
      if (data) {
        document.getElementById("display").innerText = data.time + "秒";
      }
    });
  </script>
</body>
</html>

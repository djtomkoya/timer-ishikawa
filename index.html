<!DOCTYPE html>
<html>
<head>
  <title>çŸ³å·ä¸­ç¶™ã‚¿ã‚¤ãƒãƒ¼</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 40px; }
    .timer-box {
      border: 1px solid #ccc; margin: 20px auto; padding: 10px; width: 900px; border-radius: 10px;
    }
    h2 { margin-bottom: 10px; }
    input, button { font-size: 30px; margin: 5px; padding: 5px 10px; }
    input[type="number"] { width: 150px; text-align: right; }
    .display-time {
      font-size: 140px;
      font-weight: bold;
      color: #f94903;
      margin-bottom: 15px;
    }
    .apc-title { color: rgb(232, 3, 3); font-size: 40px; 
    font-size: 67px;
  font-weight: bold;
  font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
  text-shadow: 2px 2px 5px #aaa;}

    .shohin-title {
  color: #0080ff;
  font-size: 60px;
  font-weight: bold;
  font-family:Arial, Helvetica, sans-serif;
  text-shadow: 2px 2px 5px #aaa;
  
}
.recap-title {
  color: #003937;      /* ã‚ªãƒ¬ãƒ³ã‚¸ã£ã½ã„æ´¾æ‰‹ãªè‰² */
  font-size: 60px;
  font-weight: bold;
  text-shadow: 2px 2px 5px #aaa;
  font-family: 'Arial Black', sans-serif;
}
.comment-title {
  font-size: 50px;
  font-weight: bold;
  color: #000703;  /* ç·‘è‰²ã§ç›®ç«‹ã¤ */
  text-shadow: 1px 1px 3px #aaa;
  font-family: 'Arial Black', sans-serif;
}
.nextseg-title {
  font-size: 50px;
  font-weight: bold;
  color: #242325; /* ç´«è‰² */
  text-shadow: 1px 1px 3px #aaa;
}
button {
  background-color: #5485bc; /* é»’èƒŒæ™¯ */
  color: #ffffff;   
  font-weight: bold;         /* ç™½æ–‡å­— */
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #333333; /* ãƒ›ãƒãƒ¼æ™‚å°‘ã—æ˜ã‚‹ã */
}

  </style>
</head>
<body>
  <h1>çŸ³å·ä¸­ç¶™ã‚¿ã‚¤ãƒãƒ¼</h1>

  <div id="timers"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAfWHKmXad82HBw0zU-8k1t5OGKP5zhAdA",
      authDomain: "timer-ishikawa.firebaseapp.com",
      databaseURL: "https://timer-ishikawa-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "timer-ishikawa",
      appId: "1:367450670827:web:a721a9f1484370ca8e20ae",
      measurementId: "G-E7G8PKG9BZ",
      messagingSenderId: "367450670827"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const intervals = {};

    const timerLabels = [
      "å•†å“æ™‚é–“",
      "â‘ ã‚³ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚º",
      "â‘¡ã‚³ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚º",
      "â‘¢ã‚³ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚º",
      "ãƒªã‚­ãƒ£ãƒƒãƒ—ã¾ã§",
      "APCã¾ã§",
      "æ¬¡ã‚»ã‚°ã‚¹ã‚¿ãƒ¼ãƒˆã¾ã§"
    ];

    const timerKeys = [
      "timer1", "timer2", "timer3", "timer4", "timer5", "timer6", "timer7"
    ];

    const container = document.getElementById("timers");

    timerLabels.forEach((label, i) => {
      const name = timerKeys[i];
      const isAPC = label.includes("APC");
      const isShohin = label.includes("å•†å“æ™‚é–“"); 
      const isRecap = label.includes("ãƒªã‚­ãƒ£ãƒƒãƒ—");
      const isComment = label.includes("ã‚³ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚º");
      const isNextSeg = label.includes("æ¬¡ã‚»ã‚°ã‚¹ã‚¿ãƒ¼ãƒˆ");


      const box = document.createElement("div");
      box.className = "timer-box";
      box.innerHTML = `
      <h2 class="${isAPC ? 'apc-title' : isShohin ? 'shohin-title' : isRecap ? 'recap-title' : isComment ? 'comment-title' : isNextSeg ? 'nextseg-title' : ''}">${label}</h2>


        <div id="display${i}" class="display-time">--:--:--</div>
        <input type="number" id="quick${i}" placeholder="ä¾‹: 15415" onchange="convertQuick(${i})"> â†ã¾ã¨ã‚ã¦å…¥åŠ›<br/>
        <input type="number" id="h${i}" min="0" value="0"> h
        <input type="number" id="m${i}" min="0" max="59" value="0"> m
        <input type="number" id="s${i}" min="0" max="59" value="0"> s <br/>
        <button onclick="startTimer('${name}', ${i})">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button onclick="resetTimer('${name}', ${i})">ãƒªã‚»ãƒƒãƒˆ</button>
        ${
    ã€€ã€€ã€€ã€€(isShohin || isRecap) ? `
   ã€€ã€€ã€€ã€€ <br/>
   ã€€ã€€ã€€ã€€ <button onclick="adjustTimer('${name}', 60)">ï¼‹1åˆ†</button>
  ã€€ã€€ã€€ã€€  <button onclick="adjustTimer('${name}', -60)">âˆ’1åˆ†</button>
ã€€ã€€ã€€ã€€ã€€  ` : ''}
    ã€€  `;
      container.appendChild(box);

      const timerRef = ref(db, "sharedTimers/" + name);
      onValue(timerRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
          document.getElementById("display" + i).innerText = formatTime(data.time);
        }
      });
    });

   function formatTime(seconds) {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = seconds % 60;

  const hh = String(h).padStart(1, "0");
  const mm = String(m).padStart(2, "0");
  const ss = String(s).padStart(2, "0");

  return `${h}:${mm}:${ss}`;
}

    

    window.startTimer = function (name, i) {
      const h = parseInt(document.getElementById("h" + i).value) || 0;
      const m = parseInt(document.getElementById("m" + i).value) || 0;
      const s = parseInt(document.getElementById("s" + i).value) || 0;
      let countdown = h * 3600 + m * 60 + s;

      const timerRef = ref(db, "sharedTimers/" + name);
      clearInterval(intervals[name]);
      set(timerRef, { time: countdown, running: true });

      intervals[name] = setInterval(() => {
        countdown--;
        if (countdown < 0) {
          clearInterval(intervals[name]);
          return;
        }
        set(timerRef, { time: countdown, running: true });
      }, 1000);
    };


    window.convertQuick = function (i) {
      const val = document.getElementById("quick" + i).value.trim();
      if (!/^[0-9]+$/.test(val)) return;
      const padded = val.padStart(6, "0");
      const h = parseInt(padded.slice(0, -4)) || 0;
      const m = parseInt(padded.slice(-4, -2)) || 0;
      const s = parseInt(padded.slice(-2)) || 0;
      document.getElementById("h" + i).value = h;
      document.getElementById("m" + i).value = m;
      document.getElementById("s" + i).value = s;
      
    };
    window.resetTimer = function (name, i) {
  clearInterval(intervals[name]);

  // å…¥åŠ›æ¬„ã‚’ã™ã¹ã¦ç©ºã«ã™ã‚‹
  document.getElementById("h" + i).value = "";
  document.getElementById("m" + i).value = "";
  document.getElementById("s" + i).value = "";
  document.getElementById("quick" + i).value = "";

  // ã‚¿ã‚¤ãƒãƒ¼ã‚’0ç§’ã§æ­¢ã‚ã‚‹
  const timerRef = ref(db, "sharedTimers/" + name);
  set(timerRef, { time: 0, running: false });
};

ã€€ã€€ // ğŸ†• è¿½åŠ ï¼šåŠ ç®—ãƒ»æ¸›ç®—é–¢æ•°
    window.adjustTimer = function (name, delta) {
      const timerRef = ref(db, "sharedTimers/" + name);
      onValue(timerRef, (snapshot) => {
        const data = snapshot.val();
        if (!data) return;
        let newTime = (data.time || 0) + delta;
        if (newTime < 0) newTime = 0;
        set(timerRef, { time: newTime, running: data.running });
      }, { onlyOnce: true });
    };
    
  </script>
</body>
</html>

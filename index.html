<!DOCTYPE html>
<html>
<head>
 <title>石川中継タイマー</title>
 <style>
   body { font-family: sans-serif; text-align: center; margin-top: 40px; }
   .timer-box {
     border: 1px solid #ccc; margin: 20px auto; padding: 10px; width: 950px; border-radius: 10px;
   }
   h2 { margin-bottom: 10px; }
   input, button { font-size: 30px; margin: 5px; padding: 5px 10px; }
   input[type="number"] { width: 150px; text-align: right; }
 .display-time {
     font-size: 200px;
     font-weight: bold;
     color: #f94903;
     margin-bottom: 15px;
   }

.apc-title { color: rgb(232, 3, 3); font-size: 40px;
   font-size: 80px;
 font-weight: bold;
 font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
 text-shadow: 2px 2px 5px #aaa;}

.shohin-title {
 color: #0080ff;
 font-size: 70px;
 font-weight: bold;
 font-family:Arial, Helvetica, sans-serif;
 text-shadow: 2px 2px 5px #aaa;

}
.recap-title {
 color: #003937;      /* オレンジっぽい派手な色 */
 font-size: 70px;
 font-weight: bold;
 text-shadow: 2px 2px 5px #aaa;
 font-family: 'Arial Black', sans-serif;
}
.comment-title {
 font-size: 60px;
 font-weight: bold;
 color: #000703;  /* 緑色で目立つ */
 text-shadow: 1px 1px 3px #aaa;
 font-family: 'Arial Black', sans-serif;
}
.nextseg-title {
 font-size: 70px;
 font-weight: bold;
 color: #242325; /* 紫色 */
 text-shadow: 1px 1px 3px #aaa;
}
.Hanyou-title {
 font-size: 60px;
 font-weight: bold;
 color: #061104; /* 緑 */
 text-shadow: 1px 1px 3px #aaa;
}
.Ending-title {
 font-size: 70px;
 font-weight: bold;
 color: #0d0c0f; /* 茶色 */
 text-shadow: 1px 1px 3px #aaa;
}
button {
 background-color: #5485bc; /* 黒背景 */
 color: #ffffff;   
 font-weight: bold;         /* 白文字 */
 border: none;
 border-radius: 5px;
 cursor: pointer;
 transition: background-color 0.3s ease;
}

button:hover {
 background-color: #333333; /* ホバー時少し明るく */
}
.clock-time {
  font-size: 60px;
  color: #070607;
  margin-bottom: 10px;
  font-weight: bold;
}
.timer-box:last-child {
 margin-bottom: 70px;
  }

 </style>
</head>

<body>
 <h1>石川中継タイマー</h1>

 <div id="timers"></div>

 <script type="module">
   import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
   import { getDatabase, ref, set, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

   const firebaseConfig = {
     apiKey: "AIzaSyAfWHKmXad82HBw0zU-8k1t5OGKP5zhAdA",
     authDomain: "timer-ishikawa.firebaseapp.com",
     databaseURL: "https://timer-ishikawa-default-rtdb.asia-southeast1.firebasedatabase.app",
     projectId: "timer-ishikawa",
     appId: "1:367450670827:web:a721a9f1484370ca8e20ae",
     measurementId: "G-E7G8PKG9BZ",
     messagingSenderId: "367450670827"
   };

   const app = initializeApp(firebaseConfig);
   const db = getDatabase(app);
   const intervals = {};
   const clientId = localStorage.getItem('clientId') || crypto.randomUUID();
   localStorage.setItem('clientId', clientId);

   const PASSWORD = "1234"; // 任意のパスワード

   function updateClockTime() {
     const now = new Date();
     const hh = String(now.getHours()).padStart(2, '0');
     const mm = String(now.getMinutes()).padStart(2, '0');
     const ss = String(now.getSeconds()).padStart(2, '0');
     const timeStr = `${hh}:${mm}:${ss}`;
     document.querySelectorAll(".clock-time").forEach(el => el.innerText = timeStr);
   }
   setInterval(updateClockTime, 1000);

   const timerLabels = [
     "商品時間", "①コメントポーズ", "②コメントポーズ", "③コメントポーズ",
     "リキャップまで", "APCまで", "次セグスタートまで", "エンディングまで", "汎用タイマー"
   ];
   const timerKeys = [
     "timer1", "timer2", "timer3", "timer4", "timer5", "timer6", "timer7", "timer8", "timer9"
   ];

   const container = document.getElementById("timers");

   timerLabels.forEach((label, i) => {
     const name = timerKeys[i];
     const titleClass = label.includes("APC") ? 'apc-title' :
       label.includes("商品") ? 'shohin-title' :
       label.includes("リキャップ") ? 'recap-title' :
       label.includes("コメント") ? 'comment-title' :
       label.includes("次セグ") ? 'nextseg-title' :
       label.includes("エンディング") ? 'Ending-title' :
       label.includes("汎用") ? 'Hanyou-title' : '';

     const box = document.createElement("div");
     box.className = "timer-box";
     box.innerHTML = `
       <h2 class="${titleClass}">${label}</h2>
       <div class="clock-time">--:--:--</div>
       <div id="display${i}" class="display-time">--:--:--</div>
       <input type="number" id="quick${i}" placeholder="例: 15415" onchange="convertQuick(${i})"> ←まとめて入力<br/>
       <input type="number" id="h${i}" min="0" value="0"> h
       <input type="number" id="m${i}" min="0" max="59" value="0"> m
       <input type="number" id="s${i}" min="0" max="59" value="0"> s <br/>
       <button onclick="startTimer('${name}', ${i})">スタート</button>
       <button onclick="resetTimer('${name}', ${i})">リセット</button>
     `;
     container.appendChild(box);

     const timerRef = ref(db, "sharedTimers/" + name);
     onValue(timerRef, (snapshot) => {
       const data = snapshot.val();
       if (data) {
         const now = Date.now();
         const remaining = Math.max(0, Math.floor((data.endAt - now) / 1000));
         document.getElementById("display" + i).innerText = formatTime(remaining);
       }
     });
   });

   function formatTime(seconds) {
     const h = Math.floor(seconds / 3600);
     const m = Math.floor((seconds % 3600) / 60);
     const s = seconds % 60;
     return `${h}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
   }

   window.startTimer = function(name, i) {
     const h = parseInt(document.getElementById("h" + i).value) || 0;
     const m = parseInt(document.getElementById("m" + i).value) || 0;
     const s = parseInt(document.getElementById("s" + i).value) || 0;
     const countdown = h * 3600 + m * 60 + s;
     const endAt = Date.now() + countdown * 1000;
     const timerRef = ref(db, "sharedTimers/" + name);

     set(timerRef, { endAt, owner: clientId });
     
     document.getElementById("display" + i).innerText = formatTime(countdown);  //追加//
};
   

   window.resetTimer = function(name, i) {
     const timerRef = ref(db, "sharedTimers/" + name);
     onValue(timerRef, (snapshot) => {
       const data = snapshot.val();
       if (!data || data.owner !== clientId) {
         const pw = prompt("パスワード");
         if (pw !== PASSWORD) {
           alert("パスワードが違います。");
           return;
         }
       }
       document.getElementById("h" + i).value = "";
       document.getElementById("m" + i).value = "";
       document.getElementById("s" + i).value = "";
       document.getElementById("quick" + i).value = "";
       set(timerRef, { endAt: 0, owner: data?.owner || clientId });
     }, { onlyOnce: true });
   };

   window.convertQuick = function (i) {
     const val = document.getElementById("quick" + i).value.trim();
     if (!/^[0-9]+$/.test(val)) return;
     const padded = val.padStart(6, "0");
     const h = parseInt(padded.slice(0, -4)) || 0;
     const m = parseInt(padded.slice(-4, -2)) || 0;
     const s = parseInt(padded.slice(-2)) || 0;
     document.getElementById("h" + i).value = h;
     document.getElementById("m" + i).value = m;
     document.getElementById("s" + i).value = s;
   };
 </script>
</body>
</html>
